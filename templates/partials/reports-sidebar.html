<!-- templates/partials/reports-sidebar.html -->
{% load static %}

<div class="h-full flex flex-col bg-white">
    
    <!-- Filtros e Busca -->
    <div class="p-4 border-b border-slate-200">
        <!-- Busca Local -->
        <div class="relative mb-3">
            <input type="text" 
                   id="sidebar-search"
                   placeholder="Filtrar relatórios..."
                   class="w-full pl-9 pr-8 py-2 text-sm border border-slate-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-xs"></i>
            <button class="absolute right-2 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 hidden" id="clear-search">
                <i class="fas fa-times text-xs"></i>
            </button>
        </div>
        
        <!-- Filtros Rápidos -->
        <div class="flex flex-wrap gap-2">
            <button class="filter-tag active" data-filter="all">
                <i class="fas fa-list text-xs mr-1"></i>Todos
            </button>
            <button class="filter-tag" data-filter="favorites">
                <i class="fas fa-star text-xs mr-1"></i>Favoritos
            </button>
            <button class="filter-tag" data-filter="recent">
                <i class="fas fa-clock text-xs mr-1"></i>Recentes
            </button>
            {% if is_tecnico %}
                <button class="filter-tag" data-filter="mine">
                    <i class="fas fa-user text-xs mr-1"></i>Meus
                </button>
            {% endif %}
        </div>
    </div>

    <!-- Navegação Principal -->
    <div class="px-4 py-3 border-b border-slate-200">
        <nav class="space-y-1">
            <!-- Dashboard -->
            <a href="{% url 'core:dashboard' %}" 
               class="nav-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="fas fa-tachometer-alt nav-icon"></i>
                <span class="nav-text">Dashboard</span>
                <div class="nav-indicator"></div>
            </a>
            
            {% if is_tecnico %}
                <!-- Administração -->
                <div class="nav-section">
                    <div class="nav-section-header">
                        <i class="fas fa-cog text-xs mr-2"></i>
                        <span>Administração</span>
                    </div>
                    
                    <a href="{% url 'connections:list' %}" 
                       class="nav-item {% if 'connections' in request.resolver_match.namespace %}active{% endif %}">
                        <i class="fas fa-database nav-icon"></i>
                        <span class="nav-text">Conexões</span>
                        <span class="nav-badge">{{ connections_count|default:0 }}</span>
                        <div class="nav-indicator"></div>
                    </a>
                    
                    <a href="#" class="nav-item">
                        <i class="fas fa-users nav-icon"></i>
                        <span class="nav-text">Usuários</span>
                        <span class="nav-badge">{{ total_users|default:0 }}</span>
                        <div class="nav-indicator"></div>
                    </a>
                    
                    <a href="#" class="nav-item">
                        <i class="fas fa-cogs nav-icon"></i>
                        <span class="nav-text">Configurações</span>
                        <div class="nav-indicator"></div>
                    </a>
                </div>
            {% endif %}
        </nav>
    </div>

    <!-- Estrutura de Relatórios -->
    <div class="flex-1 overflow-y-auto">
        <div class="px-4 py-3">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-semibold text-slate-700">Relatórios</h3>
                {% if is_tecnico %}
                    <button class="text-slate-400 hover:text-blue-600 text-xs" title="Novo Relatório">
                        <i class="fas fa-plus"></i>
                    </button>
                {% endif %}
            </div>
            
            <!-- Árvore de Pastas -->
            <div class="folder-tree" id="reports-tree">
                <!-- Raiz -->
                <div class="folder-item" data-folder-id="root">
                    <div class="folder-header">
                        <button class="folder-toggle">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </button>
                        <i class="fas fa-folder text-yellow-500 mr-2"></i>
                        <span class="folder-name">Todos os Relatórios</span>
                        <span class="folder-count">({{ reports_count|default:0 }})</span>
                    </div>
                    
                    <div class="folder-children ml-4">
                        <!-- Pasta: Financeiro -->
                        <div class="folder-item" data-folder-id="1">
                            <div class="folder-header">
                                <button class="folder-toggle">
                                    <i class="fas fa-chevron-right text-xs"></i>
                                </button>
                                <i class="fas fa-folder text-blue-500 mr-2"></i>
                                <span class="folder-name">Financeiro</span>
                                <span class="folder-count">(12)</span>
                            </div>
                            
                            <div class="folder-children ml-4 hidden">
                                <!-- Relatório -->
                                <div class="report-item" data-report-id="1">
                                    <div class="report-header">
                                        <i class="fas fa-chart-line text-green-500 mr-2"></i>
                                        <span class="report-name">Vendas Mensais</span>
                                        <div class="report-actions">
                                            <button class="report-action" title="Favoritar">
                                                <i class="far fa-star text-xs"></i>
                                            </button>
                                            <button class="report-action" title="Executar">
                                                <i class="fas fa-play text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="report-meta">
                                        <span class="report-status status-online"></span>
                                        <span class="report-exec-count">142 exec.</span>
                                    </div>
                                </div>
                                
                                <div class="report-item" data-report-id="2">
                                    <div class="report-header">
                                        <i class="fas fa-chart-bar text-blue-500 mr-2"></i>
                                        <span class="report-name">Contas a Receber</span>
                                        <div class="report-actions">
                                            <button class="report-action active" title="Favorito">
                                                <i class="fas fa-star text-xs"></i>
                                            </button>
                                            <button class="report-action" title="Executar">
                                                <i class="fas fa-play text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="report-meta">
                                        <span class="report-status status-online"></span>
                                        <span class="report-exec-count">89 exec.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pasta: Operacional -->
                        <div class="folder-item" data-folder-id="2">
                            <div class="folder-header">
                                <button class="folder-toggle">
                                    <i class="fas fa-chevron-right text-xs"></i>
                                </button>
                                <i class="fas fa-folder text-purple-500 mr-2"></i>
                                <span class="folder-name">Operacional</span>
                                <span class="folder-count">(8)</span>
                            </div>
                            
                            <div class="folder-children ml-4 hidden">
                                <div class="report-item" data-report-id="3">
                                    <div class="report-header">
                                        <i class="fas fa-boxes text-orange-500 mr-2"></i>
                                        <span class="report-name">Estoque Atual</span>
                                        <div class="report-actions">
                                            <button class="report-action" title="Favoritar">
                                                <i class="far fa-star text-xs"></i>
                                            </button>
                                            <button class="report-action" title="Executar">
                                                <i class="fas fa-play text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="report-meta">
                                        <span class="report-status status-warning"></span>
                                        <span class="report-exec-count">23 exec.</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Relatórios na Raiz -->
                        <div class="report-item" data-report-id="4">
                            <div class="report-header">
                                <i class="fas fa-chart-pie text-indigo-500 mr-2"></i>
                                <span class="report-name">Dashboard Executivo</span>
                                <div class="report-actions">
                                    <button class="report-action active" title="Favorito">
                                        <i class="fas fa-star text-xs"></i>
                                    </button>
                                    <button class="report-action" title="Executar">
                                        <i class="fas fa-play text-xs"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="report-meta">
                                <span class="report-status status-online"></span>
                                <span class="report-exec-count">456 exec.</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer com Status -->
    <div class="p-4 border-t border-slate-200 bg-slate-50">
        <!-- System Status -->
        <div class="flex items-center justify-between mb-3">
            <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-xs text-slate-600">Sistema Online</span>
            </div>
            <div class="flex items-center space-x-2">
                <i class="fas fa-database text-slate-400 text-xs"></i>
                <span class="text-xs text-slate-500">{{ connections_count|default:0 }} conexões</span>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="grid grid-cols-2 gap-3 text-xs">
            <div class="text-center">
                <div class="font-semibold text-slate-700">{{ available_reports|default:reports_count|default:0 }}</div>
                <div class="text-slate-500">Relatórios</div>
            </div>
            <div class="text-center">
                <div class="font-semibold text-slate-700">{{ folders_count|default:0 }}</div>
                <div class="text-slate-500">Pastas</div>
            </div>
        </div>

        <!-- Version Info -->
        <div class="text-center mt-3 pt-3 border-t border-slate-200">
            <span class="text-xs text-slate-400">ForgeReports v{{ forge_version|default:"2.0" }}</span>
        </div>
    </div>
</div>

<style>
/* Sidebar Styles */
.filter-tag {
    @apply inline-flex items-center px-2 py-1 text-xs bg-slate-100 text-slate-600 rounded-md hover:bg-slate-200 transition-colors;
}

.filter-tag.active {
    @apply bg-blue-100 text-blue-700;
}

.nav-item {
    @apply relative flex items-center px-3 py-2 text-sm text-slate-700 rounded-lg hover:bg-slate-50 transition-all duration-200;
}

.nav-item.active {
    @apply bg-blue-50 text-blue-700;
}

.nav-item .nav-indicator {
    @apply absolute left-0 top-0 bottom-0 w-1 bg-blue-600 rounded-r-full opacity-0 transition-opacity;
}

.nav-item.active .nav-indicator {
    @apply opacity-100;
}

.nav-icon {
    @apply w-4 text-center mr-3;
}

.nav-text {
    @apply flex-1;
}

.nav-badge {
    @apply ml-auto text-xs bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full;
}

.nav-item.active .nav-badge {
    @apply bg-blue-200 text-blue-700;
}

.nav-section {
    @apply mt-4 first:mt-0;
}

.nav-section-header {
    @apply flex items-center text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2;
}

/* Folder Tree */
.folder-item {
    @apply mb-1;
}

.folder-header {
    @apply flex items-center py-1.5 px-2 text-sm text-slate-700 rounded hover:bg-slate-50 cursor-pointer;
}

.folder-toggle {
    @apply mr-1 p-1 hover:bg-slate-200 rounded transition-colors;
}

.folder-name {
    @apply flex-1 font-medium;
}

.folder-count {
    @apply text-xs text-slate-500;
}

.folder-children {
    @apply border-l border-slate-200 ml-2;
}

/* Report Items */
.report-item {
    @apply py-1.5 px-2 rounded hover:bg-slate-50 cursor-pointer;
}

.report-header {
    @apply flex items-center text-sm;
}

.report-name {
    @apply flex-1 text-slate-700;
}

.report-actions {
    @apply flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity;
}

.report-item:hover .report-actions {
    @apply opacity-100;
}

.report-action {
    @apply p-1 text-slate-400 hover:text-slate-600 rounded transition-colors;
}

.report-action.active {
    @apply text-yellow-500;
}

.report-meta {
    @apply flex items-center mt-1 text-xs text-slate-500 space-x-2;
}

.report-status {
    @apply w-2 h-2 rounded-full;
}

.status-online {
    @apply bg-green-400;
}

.status-warning {
    @apply bg-yellow-400;
}

.status-offline {
    @apply bg-red-400;
}

.report-exec-count {
    @apply text-slate-400;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Folder toggle functionality
    document.querySelectorAll('.folder-toggle').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            const folderItem = this.closest('.folder-item');
            const children = folderItem.querySelector('.folder-children');
            const icon = this.querySelector('i');
            
            if (children) {
                children.classList.toggle('hidden');
                icon.classList.toggle('fa-chevron-right');
                icon.classList.toggle('fa-chevron-down');
            }
        });
    });
    
    // Search functionality
    const searchInput = document.getElementById('sidebar-search');
    const clearButton = document.getElementById('clear-search');
    
    searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        clearButton.classList.toggle('hidden', !query);
        
        // Filter logic would go here
        filterReports(query);
    });
    
    clearButton.addEventListener('click', function() {
        searchInput.value = '';
        clearButton.classList.add('hidden');
        filterReports('');
    });
    
    // Filter tags
    document.querySelectorAll('.filter-tag').forEach(tag => {
        tag.addEventListener('click', function() {
            document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            const filter = this.dataset.filter;
            applyFilter(filter);
        });
    });
});

function filterReports(query) {
    // Implementation for filtering reports based on search
    console.log('Filtering reports:', query);
}

function applyFilter(filter) {
    // Implementation for applying different filters
    console.log('Applying filter:', filter);
}
</script>